[TOC]

# 内存屏障

屏障指令:
1. 写内存屏障（Store Memory Barrier）：处理器将存储缓存值写回主存（阻塞方式）.
2. 读内存屏障（Load Memory Barrier）：处理器，处理失效队列（阻塞方式）.

屏障类型:

|      屏障类型         |        伪代码         |          说明            |
| :------------------: | :------------------: | :---------------------: |
| LoadLoad Barrier     | Load1;Barrier;Load2  | 确保 Load1 数据的读取,先于 Load2 及后续读取指令 |
| StoreStore Barrier   | Store1;Barrier;Store2 | 确保 Store1 数据对其它处理器可见 ( 刷新到内存 ) 先于 Store2 前写入完成, 并对所有处理器可见 |
| LoadStore Barrier    | Load1;Barrier;Store2  | Load1 在 Store2 之前读取完成 |
| StoreLoad Barrier | Store1;Barrier;Load2 | Store1 在 Load2 之前写入完成,并对所有处理器可见 |

- volatile : **读前插**读屏障，**写后加**写屏障，**避免CPU重排**导致的问题，实现多线程之间数据的**可见性**。
- 对于处理器来说，内存屏障会导致**cpu缓存的刷新**，刷新时，会遵循缓存一致性协议。

