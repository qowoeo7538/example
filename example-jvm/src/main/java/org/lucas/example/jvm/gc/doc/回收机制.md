# 回收机制

[TOC]

## 目录
- [finalize机制](#1finalize机制)

## 1.finalize机制
执行对象：JDK9之前，当对象在进行可达性分析后发现没有与 GC Roots 相连接的引用链，将会被第一次标记并且进行筛选，筛选的条件是此对象是否有必要执行 finalize() 方法。当对象没有覆盖 finalize() 方法，或者 finalize() 方法已经被虚拟机调用，则将这两种情况视为“不必要执行”。

执行过程：被执行的对象将会放置在一个叫做F-Queue的队列中，并在稍后由一个虚拟机自动创建的低优先级的Finalizer线程去执行，“执行”是指虚拟机会触发这个方法，并不承诺等待运行结束。稍后，GC将对F-Queue中的对象进行第二次标记，如果对象重新与引用链上的任何一个对象建立关联（如把自己赋值给某个变量或者对象的成员变量），那在第二次标记的时候将被移除“即将回收”的集合。

弊端：虚拟机不等待运行结束，原因是如果一个对象在执行 finalize() 方法中执行缓慢或者发生死循环，将导致F-Queue队列中其它对象永久处于等待，甚至导致整个内存回收系统崩溃。

作用（严重的弊端并不建议使用，JDK9之后被废弃）：
- 使对象逃脱回收
- 其它资源回收