[TOC]

## 1 原理

使用了工作窃取算法来提高性能，其内部每个工作线程都关联自己的内存队列，正常情况下每个线程从自己队列里面获取任务并执行，当本身队列没有任务时，当前线程会去其他线程关联的队列里面获取任务来执行。这在很多任务会产生子任务或者有很多小的任务被提交到线程池来执行的情况下非常高效。

### 1.1 参数

- commonParallelism ：并行度级别，非负整数。

### 1.2 使用步骤
- 第一步分割任务: 首先我们需要有一个fork类来把大任务分割成多个子任务。
- 第二步执行任务并合并结果: 分割的子任务分别放在双端队列里，然后几个线程分别从双端队列里获取任务执行。子任务执行完的结果都统一放在一个队列里，启动一个线程从队列里拿数据，然后合并这些数据。
- ForkJoinTask：创建一个ForkJoin任务。提供在任务中执行fork()和join()操作的机制，Fork/Join框架提供了以下两个子类： 
  - RecursiveAction：用于没有返回结果的任务。
  - RecursiveTask ：用于有返回结果的任务。
- ForkJoinPool ：ForkJoinTask需要通过ForkJoinPool来执行，任务分割出的子任务会添加到当前工作线程所维护的双端队列中，进入队列的头部。当一个工作线程的队列里暂时没有任务时，它会随机从其他工作线程的队列的尾部获取一个任务。